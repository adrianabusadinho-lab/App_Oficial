<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Caixa | Lanchonete</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <link rel="manifest" href="manifest.json">
    <style>
        body {
            margin: 0;
            min-height: 100vh;
            background: #a97c50;
            font-family: 'Montserrat', Arial, sans-serif;
            font-size: 16px;
            padding: 0;
        }
        header {
            background: #6d4c27;
            padding: 1rem 0.5rem;
            display: flex;
            align-items: center;
            justify-content: flex-end;
        }
        #btn-sair {
            color: #ffe600;
            font-weight: 700;
            background: none;
            border: none;
            font-size: 1.1rem;
            cursor: pointer;
            transition: color 0.2s;
        }
        #btn-sair:hover {
            color: #43ea4c;
        }
        .caixa-main {
            max-width: 1100px;
            margin: 2rem auto;
            background: #fff8f0;
            border-radius: 18px;
            box-shadow: 0 8px 32px #a97c5033, 0 2px 8px #a97c5022;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }
        .caixa-row {
            display: flex;
            gap: 2rem;
            flex-wrap: wrap;
        }
        .caixa-col {
            flex: 1;
            min-width: 320px;
            background: #f5e6d3;
            border-radius: 12px;
            padding: 1.2rem 1.5rem;
            box-shadow: 0 2px 8px #a97c5022;
        }
        .caixa-col h3 {
            color: #a97c50;
            margin-top: 0;
            margin-bottom: 1rem;
        }
        .caixa-form label {
            font-weight: 700;
            color: #a97c50;
            margin-bottom: 0.2rem;
        }
        .caixa-form input, .caixa-form select {
            width: 100%;
            padding: 0.5rem;
            border-radius: 8px;
            border: 1.5px solid #a97c50;
            font-size: 1rem;
            margin-bottom: 0.7rem;
            background: #fff;
            color: #231f20;
        }
        .caixa-form button,
        #btn-fechar-caixa {
            background: #43ea4c;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 0.6rem 1.3rem;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
            margin-top: 0.5rem;
            display: inline-block;
        }
        .caixa-form button:hover,
        #btn-fechar-caixa:hover {
            background: #ffe600;
            color: #a97c50;
        }
        .caixa-tabela {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1rem;
        }
        .caixa-tabela th, .caixa-tabela td {
            border-bottom: 1px solid #e0c9b0;
            padding: 0.4rem 0.6rem;
            text-align: left;
        }
        .caixa-tabela th {
            color: #a97c50;
            font-size: 1rem;
        }
        .caixa-tabela td {
            color: #231f20;
            font-size: 1rem;
        }
        .caixa-resumo {
            background: #fff8f0;
            border-radius: 10px;
            padding: 1rem 1.5rem;
            margin-top: 1rem;
            color: #231f20;
            font-size: 1.1rem;
        }
        .caixa-resumo strong {
            color: #a97c50;
        }
        @media (max-width: 900px) {
            .caixa-main {
                padding: 1rem;
            }
            .caixa-row {
                flex-direction: column;
                gap: 1rem;
            }
            .caixa-col {
                min-width: 0;
                width: 100%;
                padding: 1rem 0.7rem;
            }
        }
        @media (max-width: 600px) { /* Celular */
            body {
                font-size: 14px;
                padding: 0 0.5rem;
            }
            .caixa-main {
                padding: 0.5rem 0.2rem;
                border-radius: 10px;
                width: 100vw;
                min-width: 0;
            }
            .caixa-col {
                padding: 0.7rem 0.2rem;
                border-radius: 8px;
                margin-bottom: 0.7rem;
            }
            .caixa-form input,
            .caixa-form select {
                font-size: 0.95rem;
                padding: 0.4rem;
                border-radius: 6px;
                margin-bottom: 0.5rem;
            }
            .caixa-form button,
            #btn-fechar-caixa {
                font-size: 0.95rem;
                padding: 0.5rem 1rem;
                border-radius: 7px;
            }
            .caixa-tabela th,
            .caixa-tabela td {
                font-size: 0.9rem;
                padding: 0.2rem 0.2rem;
            }
            .caixa-resumo {
                font-size: 1rem;
                padding: 0.7rem 0.5rem;
                border-radius: 8px;
            }
            header {
                padding: 0.7rem 1rem 0.3rem 1rem;
            }
            #btn-sair {
                font-size: 0.95rem;
                padding: 0.4rem 0.8rem;
            }
        }

        @media (max-width: 400px) {
            .caixa-main {
                padding: 0.2rem 0.05rem;
            }
            .caixa-col {
                padding: 0.3rem 0.05rem;
                border-radius: 6px;
            }
            .caixa-tabela th,
            .caixa-tabela td {
                font-size: 0.85rem;
                padding: 0.1rem 0.1rem;
            }
            .caixa-form button,
            #btn-fechar-caixa {
                font-size: 0.9rem;
                padding: 0.4rem 0.7rem;
                border-radius: 6px;
            }
        }
    </style>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
    <script src="firebase-config.js"></script>
</head>
<body>
    <header>
        <button id="btn-sair">Sair</button>
    </header>
    <div class="caixa-main">
        <div class="caixa-row">
            <!-- Abertura de caixa -->
            <div class="caixa-col">
                <h3>Abertura de Caixa</h3>
                <form class="caixa-form" id="form-abertura">
                    <label for="valor-abertura">Valor Inicial</label>
                    <input type="number" id="valor-abertura" min="0" step="0.01" required>
                    <button type="submit">Abrir Caixa</button>
                </form>
                <div id="abertura-info"></div>
                <button id="btn-fechar-caixa" style="display:none;">Fechar Caixa</button>
                <div id="fechamento-info" style="margin-top:1rem;color:#a02020;font-weight:700;"></div>
                <!-- Adicionar valor extra (entrada avulsa) -->
                <hr style="margin:1.5rem 0;">
                <form class="caixa-form" id="form-entrada-extra">
                    <label for="descricao-entrada-extra">Entrada Avulsa</label>
                    <input type="text" id="descricao-entrada-extra" placeholder="Descrição" required>
                    <label for="valor-entrada-extra">Valor</label>
                    <input type="number" id="valor-entrada-extra" min="0.01" step="0.01" required>
                    <label for="tipo-entrada-extra">Tipo de Pagamento</label>
                    <select id="tipo-entrada-extra" required>
                        <option value="dinheiro">Dinheiro</option>
                        <option value="cartao">Cartão</option>
                        <option value="pix">Pix</option>
                    </select>
                    <label for="cliente-entrada-extra">Cliente (opcional)</label>
                    <input type="text" id="cliente-entrada-extra" placeholder="Nome do cliente">
                    <button type="submit">Adicionar Entrada</button>
                </form>
            </div>
            <!-- Saídas -->
            <div class="caixa-col">
                <h3>Registrar Saída</h3>
                <form class="caixa-form" id="form-saida">
                    <label for="descricao-saida">Descrição</label>
                    <input type="text" id="descricao-saida" required>
                    <label for="valor-saida">Valor</label>
                    <input type="number" id="valor-saida" min="0.01" step="0.01" required>
                    <button type="submit">Registrar Saída</button>
                </form>
                <div>
                    <table class="caixa-tabela" id="tabela-saidas">
                        <thead>
                            <tr>
                                <th>Descrição</th>
                                <th>Valor</th>
                                <th>Data/Hora</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
        <!-- Entradas (Pedidos) -->
        <div class="caixa-col">
            <h3>Entradas (Pedidos do Dia)</h3>
            <table class="caixa-tabela" id="tabela-entradas">
                <thead>
                    <tr>
                        <th>Data</th>
                        <th>Horário</th>
                        <th>Cliente</th>
                        <th>Valor</th>
                        <th>Pagamento</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
        <!-- Resumo do turno/dia -->
        <div class="caixa-col">
            <h3>Resumo do Turno/Dia</h3>
            <div class="caixa-resumo" id="caixa-resumo">
                Carregando...
            </div>
        </div>
    </div>
    <script>
        // auth.onAuthStateChanged(user => {
        //     if (!user) window.location.href = "login.html";
        // });

        document.getElementById('btn-sair').onclick = function() {
            auth.signOut().then(() => window.location.href = "inicio.html");
        };

        let valorAbertura = 0;
        let aberto = false;
        let saidas = [];
        let entradas = [];
        let entradasExtras = [];
        let caixaFechado = false;
        let caixaKey = null; // chave do turno atual

        // Função para verificar se o caixa está aberto
        function isCaixaAberto() {
            return aberto && !caixaFechado;
        }

        // Bloqueia/desbloqueia formulários conforme o estado do caixa
        function atualizarFormulariosCaixa() {
            const disabled = !isCaixaAberto();
            document.querySelectorAll('#form-saida input, #form-saida button, #form-entrada-extra input, #form-entrada-extra button, #form-entrada-extra select')
                .forEach(el => el.disabled = disabled);
        }

        // Salva todos os dados do turno no Firebase
        function salvarEstadoCaixa() {
            if (!caixaKey) return;
            db.ref('caixa_turnos/' + caixaKey).set({
                valorAbertura,
                saidas,
                entradasExtras,
                aberto,
                fechado: caixaFechado,
                dataAbertura: window.dataAbertura || null
            });
        }

        // Carrega todos os dados do turno do Firebase
        function carregarEstadoCaixa(callback) {
            db.ref('caixa_aberto').once('value').then(snap => {
                aberto = !!snap.val();
                caixaFechado = !aberto;
                if (aberto) {
                    db.ref('caixa_turnos').orderByChild('aberto').equalTo(true).limitToLast(1).once('value').then(turnosSnap => {
                        let turno = null, key = null;
                        turnosSnap.forEach(child => { turno = child.val(); key = child.key; });
                        caixaKey = key;
                        if (turno) {
                            valorAbertura = turno.valorAbertura || 0;
                            saidas = turno.saidas || [];
                            entradasExtras = turno.entradasExtras || [];
                            window.dataAbertura = turno.dataAbertura || null;
                        }
                        if (callback) callback();
                    });
                } else {
                    valorAbertura = 0;
                    saidas = [];
                    entradasExtras = [];
                    caixaKey = null;
                    window.dataAbertura = null;
                    if (callback) callback();
                }
            });
        }

        // Abertura de caixa
        document.getElementById('form-abertura').onsubmit = function(e) {
            e.preventDefault();
            db.ref('caixa_aberto').once('value').then(snap => {
                if (snap.val()) {
                    alert("O caixa já está aberto!");
                    return;
                }
                valorAbertura = parseFloat(document.getElementById('valor-abertura').value);
                aberto = true;
                caixaFechado = false;
                saidas = [];
                entradasExtras = [];
                window.dataAbertura = new Date().toISOString();
                // Cria novo turno no banco
                let novoTurno = db.ref('caixa_turnos').push({
                    valorAbertura,
                    saidas,
                    entradasExtras,
                    aberto: true,
                    fechado: false,
                    dataAbertura: window.dataAbertura
                });
                caixaKey = novoTurno.key;
                db.ref('caixa_aberto').set(true);
                document.getElementById('abertura-info').innerHTML = `<strong>Caixa aberto com R$ ${valorAbertura.toFixed(2)}</strong>`;
                document.getElementById('btn-fechar-caixa').style.display = "inline-block";
                document.getElementById('form-abertura').style.display = "none";
                atualizarResumo();
                atualizarFormulariosCaixa();
                salvarEstadoCaixa();
            });
        };

        // Função para salvar dados do caixa no histórico e fechar turno
        function salvarCaixaNoHistorico() {
            const dataFechamento = new Date().toISOString();
            const historicoCaixa = {
                valorAbertura,
                saidas: [...saidas],
                entradas: [...entradas, ...entradasExtras],
                dataAbertura: window.dataAbertura || null,
                dataFechamento,
                totalVendas: entradas.reduce((sum, p) => sum + Number(p.valorTotal || 0), 0) + entradasExtras.reduce((sum, e) => sum + Number(e.valorTotal || 0), 0),
                totalSaidas: saidas.reduce((sum, s) => sum + Number(s.valor || 0), 0),
                saldoFinal: (valorAbertura || 0)
                    + entradas.reduce((sum, p) => sum + Number(p.valorTotal || 0), 0)
                    + entradasExtras.reduce((sum, e) => sum + Number(e.valorTotal || 0), 0)
                    - saidas.reduce((sum, s) => sum + Number(s.valor || 0), 0)
            };
            db.ref('historico_caixa').push(historicoCaixa);
            // Marca turno como fechado
            if (caixaKey) {
                db.ref('caixa_turnos/' + caixaKey).update({
                    aberto: false,
                    fechado: true,
                    dataFechamento
                });
            }
        }

        // Fechar caixa
        document.getElementById('btn-fechar-caixa').onclick = function() {
            if (!aberto) {
                alert("Abra o caixa primeiro!");
                return;
            }
            salvarCaixaNoHistorico();
            caixaFechado = true;
            aberto = false;
            db.ref('caixa_aberto').set(false);
            document.getElementById('fechamento-info').innerText = "Caixa fechado! Nenhuma operação pode ser feita até abrir novamente.";
            document.getElementById('btn-fechar-caixa').style.display = "none";
            document.getElementById('form-abertura').style.display = "block";
            document.getElementById('abertura-info').innerHTML = "";
            valorAbertura = 0;
            saidas = [];
            entradasExtras = [];
            caixaKey = null;
            window.dataAbertura = null;
            atualizarSaidas();
            atualizarResumo();
            carregarEntradas();
            atualizarFormulariosCaixa();
        };

        // Registrar saída
        document.getElementById('form-saida').onsubmit = function(e) {
            e.preventDefault();
            if (!isCaixaAberto()) {
                alert("Abra o caixa para registrar saídas.");
                return;
            }
            const descricao = document.getElementById('descricao-saida').value.trim();
            const valor = parseFloat(document.getElementById('valor-saida').value);
            const data = new Date().toLocaleString();
            if (!descricao || isNaN(valor) || valor <= 0) return;
            saidas.push({ descricao, valor, data });
            atualizarSaidas();
            atualizarResumo();
            document.getElementById('form-saida').reset();
            salvarEstadoCaixa();
        };

        // Entradas extras (avulsas)
        document.getElementById('form-entrada-extra').onsubmit = function(e) {
            e.preventDefault();
            if (!isCaixaAberto()) {
                alert("Abra o caixa para adicionar entradas avulsas.");
                return;
            }
            const descricao = document.getElementById('descricao-entrada-extra').value.trim();
            const valor = parseFloat(document.getElementById('valor-entrada-extra').value);
            const tipoPagamento = document.getElementById('tipo-entrada-extra').value;
            const cliente = document.getElementById('cliente-entrada-extra').value.trim();
            const data = new Date().toISOString();
            if (!descricao || isNaN(valor) || valor <= 0) return;
            entradasExtras.push({
                descricao,
                valorTotal: valor,
                tipoPagamento,
                cliente,
                data,
                key: 'extra_' + Date.now()
            });
            document.getElementById('form-entrada-extra').reset();
            carregarEntradas();
            salvarEstadoCaixa();
        };

        function atualizarSaidas() {
            let html = '';
            saidas.forEach((s, idx) => {
                html += `<tr>
                    <td>${s.descricao}</td>
                    <td>R$ ${s.valor.toFixed(2)}</td>
                    <td>${s.data}</td>
                    <td>
                        <button class="btn-editar-saida" data-idx="${idx}" style="background:#ffe600;color:#a97c50;border:none;border-radius:6px;padding:0.2rem 0.7rem;cursor:pointer;">Editar</button>
                        <button class="btn-excluir-saida" data-idx="${idx}" style="background:#a02020;color:#fff;border:none;border-radius:6px;padding:0.2rem 0.7rem;cursor:pointer;">Excluir</button>
                    </td>
                </tr>`;
            });
            document.querySelector('#tabela-saidas tbody').innerHTML = html;

            // Eventos editar/excluir saída
            document.querySelectorAll('.btn-excluir-saida').forEach(btn => {
                btn.onclick = function() {
                    if (caixaFechado) {
                        alert("Caixa fechado! Não é possível excluir saídas.");
                        return;
                    }
                    const idx = parseInt(this.getAttribute('data-idx'));
                    if (confirm("Deseja excluir esta saída?")) {
                        saidas.splice(idx, 1);
                        atualizarSaidas();
                        atualizarResumo();
                        salvarEstadoCaixa();
                    }
                };
            });
            document.querySelectorAll('.btn-editar-saida').forEach(btn => {
                btn.onclick = function() {
                    if (caixaFechado) {
                        alert("Caixa fechado! Não é possível editar saídas.");
                        return;
                    }
                    const idx = parseInt(this.getAttribute('data-idx'));
                    const saida = saidas[idx];
                    if (!saida) return;
                    const novaDescricao = prompt("Nova descrição da saída:", saida.descricao);
                    if (novaDescricao === null) return;
                    const novoValor = prompt("Novo valor da saída:", saida.valor);
                    if (novoValor === null) return;
                    const valorNum = parseFloat(novoValor.replace(",", "."));
                    if (!novaDescricao.trim() || isNaN(valorNum) || valorNum <= 0) {
                        alert("Dados inválidos!");
                        return;
                    }
                    saidas[idx].descricao = novaDescricao.trim();
                    saidas[idx].valor = valorNum;
                    atualizarSaidas();
                    atualizarResumo();
                    salvarEstadoCaixa();
                };
            });
        }

        // Carregar entradas (pedidos do dia)
        function carregarEntradas() {
            entradas = [];
            let hoje = new Date();
            let dataHoje = hoje.toISOString().slice(0,10); // yyyy-mm-dd
            db.ref('pedidos').once('value').then(snapshot => {
                let html = '';
                let totalDinheiro = 0, totalCartao = 0, totalPix = 0, totalVendas = 0;

                // Entradas do banco (pedidos)
                snapshot.forEach(child => {
                    const p = child.val();
                    if (!p.data) return;
                    if (p.data.slice(0,10) === dataHoje) {
                        entradas.push({ ...p, key: child.key, isExtra: false });
                    }
                });

                // Entradas extras (avulsas)
                entradasExtras.forEach(e => {
                    if (e.data.slice(0,10) === dataHoje) {
                        entradas.push({ ...e, isExtra: true });
                    }
                });

                // Ordena por data/hora
                entradas.sort((a, b) => new Date(a.data) - new Date(b.data));

                entradas.forEach((p, idx) => {
                    let dataObj = new Date(p.data);
                    let dataFormatada = dataObj.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' });
                    let hora = dataObj.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                    let cliente = p.cliente || "-";
                    html += `<tr>
                        <td>${dataFormatada}</td>
                        <td>${hora}</td>
                        <td>${cliente}</td>
                        <td>R$ ${Number(p.valorTotal).toFixed(2)}</td>
                        <td>${p.tipoPagamento ? p.tipoPagamento.charAt(0).toUpperCase() + p.tipoPagamento.slice(1) : '-'}</td>
                        <td>
                            ${p.isExtra
                                ? `<button class="btn-excluir-entrada-extra" data-idx="${idx}" style="background:#a02020;color:#fff;border:none;border-radius:6px;padding:0.2rem 0.7rem;cursor:pointer;">Excluir</button>`
                                : `<button class="btn-editar-entrada" data-key="${p.key}" style="background:#ffe600;color:#a97c50;border:none;border-radius:6px;padding:0.2rem 0.7rem;cursor:pointer;">Editar</button>
                                   <button class="btn-excluir-entrada" data-key="${p.key}" style="background:#a02020;color:#fff;border:none;border-radius:6px;padding:0.2rem 0.7rem;cursor:pointer;">Excluir</button>`
                            }
                        </td>
                    </tr>`;
                    // Soma totais
                    if (p.tipoPagamento === "dinheiro") totalDinheiro += Number(p.valorTotal);
                    if (p.tipoPagamento === "cartao") totalCartao += Number(p.valorTotal);
                    if (p.tipoPagamento === "pix") totalPix += Number(p.valorTotal);
                    totalVendas += Number(p.valorTotal);
                });

                document.querySelector('#tabela-entradas tbody').innerHTML = html;
                atualizarResumo(totalDinheiro, totalCartao, totalPix, totalVendas);

                // Eventos editar/excluir pedidos normais
                document.querySelectorAll('.btn-excluir-entrada').forEach(btn => {
                    btn.onclick = function() {
                        if (caixaFechado) {
                            alert("Caixa fechado! Não é possível excluir vendas.");
                            return;
                        }
                        if (confirm("Deseja excluir esta venda?")) {
                            const key = this.getAttribute('data-key');
                            db.ref('pedidos/' + key).remove().then(carregarEntradas);
                        }
                    };
                });
                document.querySelectorAll('.btn-editar-entrada').forEach(btn => {
                    btn.onclick = function() {
                        if (caixaFechado) {
                            alert("Caixa fechado! Não é possível editar vendas.");
                            return;
                        }
                        const key = this.getAttribute('data-key');
                        const entrada = entradas.find(e => e.key === key);
                        if (!entrada) return;
                        editarEntradaModal(entrada);
                    };
                });
                // Eventos excluir entrada extra
                document.querySelectorAll('.btn-excluir-entrada-extra').forEach(btn => {
                    btn.onclick = function() {
                        if (caixaFechado) {
                            alert("Caixa fechado! Não é possível excluir entradas.");
                            return;
                        }
                        const idx = parseInt(this.getAttribute('data-idx'));
                        // Só conta entradasExtras do dia
                        let extrasHoje = entradasExtras.filter(e => e.data.slice(0,10) === dataHoje);
                        let globalIdx = entradasExtras.indexOf(extrasHoje[idx - (entradas.filter(e => !e.isExtra).length)]);
                        if (globalIdx >= 0) {
                            if (confirm("Deseja excluir esta entrada avulsa?")) {
                                entradasExtras.splice(globalIdx, 1);
                                carregarEntradas();
                                salvarEstadoCaixa();
                            }
                        }
                    };
                });
            });
        }

        // Modal simples para editar entrada
        function editarEntradaModal(entrada) {
            const novoValor = prompt("Novo valor da venda:", entrada.valorTotal);
            if (novoValor === null) return;
            const valor = parseFloat(novoValor.replace(",", "."));
            if (isNaN(valor) || valor <= 0) {
                alert("Valor inválido!");
                return;
            }
            const novoTipo = prompt("Novo tipo de pagamento (dinheiro, cartao, pix):", entrada.tipoPagamento || "");
            if (!["dinheiro", "cartao", "pix"].includes(novoTipo)) {
                alert("Tipo de pagamento inválido!");
                return;
            }
            db.ref('pedidos/' + entrada.key).update({
                valorTotal: valor,
                tipoPagamento: novoTipo
            }).then(carregarEntradas);
        }

        // Resumo do turno/dia
        function atualizarResumo(totalDinheiro=0, totalCartao=0, totalPix=0, totalVendas=0) {
            let totalSaidas = saidas.reduce((sum, s) => sum + s.valor, 0);
            let saldoFinal = (valorAbertura || 0) + totalVendas - totalSaidas;
            document.getElementById('caixa-resumo').innerHTML = `
                <div><strong>Dinheiro:</strong> R$ ${totalDinheiro.toFixed(2)}</div>
                <div><strong>Cartão:</strong> R$ ${totalCartao.toFixed(2)}</div>
                <div><strong>Pix:</strong> R$ ${totalPix.toFixed(2)}</div>
                <div><strong>Total em Vendas:</strong> R$ ${totalVendas.toFixed(2)}</div>
                <div><strong>Total em Despesas:</strong> R$ ${totalSaidas.toFixed(2)}</div>
                <div style="font-size:1.3rem;margin-top:0.7rem;"><strong>Saldo Final:</strong> R$ ${saldoFinal.toFixed(2)}</div>
            `;
        }

        // Inicialização
        function inicializarCaixa() {
            carregarEstadoCaixa(function() {
                if (aberto) {
                    document.getElementById('abertura-info').innerHTML = `<strong>Caixa aberto com R$ ${valorAbertura.toFixed(2)}</strong>`;
                    document.getElementById('btn-fechar-caixa').style.display = "inline-block";
                    document.getElementById('form-abertura').style.display = "none";
                } else {
                    document.getElementById('abertura-info').innerHTML = "";
                    document.getElementById('btn-fechar-caixa').style.display = "none";
                    document.getElementById('form-abertura').style.display = "block";
                }
                atualizarFormulariosCaixa();
                atualizarSaidas();
                carregarEntradas();
                atualizarResumo();
            });
        }

        inicializarCaixa();

        // Atualizar entradas a cada 10 segundos (tempo real simples)
        setInterval(carregarEntradas, 10000);
    </script>
    <script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js');
}
</script>
</body>
</html>